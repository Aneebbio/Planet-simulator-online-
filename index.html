<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God Simulator 4.1: Land Fix</title>
    <style>
        body { background: #050508; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; transition: background 2s; overflow-x: hidden; }
        body.night { background: #000005; }
        .full-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; z-index: 3000; flex-direction: column; }
        .login-box { border: 2px solid #ed1e79; padding: 30px; border-radius: 15px; background: #111; box-shadow: 0 0 20px #ed1e79; }
        #resource-bar { background: #1a1a2e; padding: 10px; display: flex; justify-content: space-between; border-bottom: 2px solid #ed1e79; position: sticky; top: 0; z-index: 1000; }
        #main-nav { display: flex; justify-content: space-around; background: #111; padding: 10px; border-bottom: 1px solid #333; flex-wrap: wrap; }
        
        /* THE GRID FIX */
        #grid-9x9 { 
            display: grid; 
            grid-template-columns: repeat(9, 30px); 
            grid-template-rows: repeat(9, 30px);
            gap: 2px; 
            justify-content: center; 
            margin: 20px auto; 
            width: fit-content; 
            border: 2px solid #333; 
            padding: 5px;
            background: #111;
        }
        .tile { 
            width: 30px; 
            height: 30px; 
            background: #1a1a1a; /* Darker grey so empty tiles are visible */
            border: 1px solid #222; 
            border-radius: 2px; 
            transition: 0.5s; 
        }
        
        /* STAGES */
        .stage-rock { background: #636e72 !important; border-color: #b2bec3; } 
        .stage-red { background: #c0392b !important; border-color: #e74c3c; } 
        .stage-ocean { background: #0984e3 !important; border-color: #74b9ff; }
        .stage-flowers { background: #00b894 !important; border-color: #55efc4; } 
        .stage-city { background: #f1c40f !important; box-shadow: inset 0 0 5px gold; border-color: gold; }

        .upgrade-card { background: #161b33; padding: 10px; margin: 8px auto; border: 1px solid #444; border-radius: 8px; width: 85%; max-width: 400px; }
        #progress-bar { height: 100%; width: 0%; background: #00f2ff; transition: 0.5s; }
        .p-bar-bg { width: 100%; height: 10px; background: #000; border-radius: 5px; margin: 10px auto; overflow: hidden; }
        button { cursor: pointer; border: none; padding: 8px 12px; border-radius: 4px; font-weight: bold; color: white; background: #ed1e79; margin: 2px; }
        button:disabled { background: #333 !important; color: #666 !important; }
        .faith-text { color: #00f2ff; text-shadow: 0 0 5px #00f2ff; }
    </style>
</head>
<body>

    <div id="login-screen" class="full-overlay">
        <div class="login-box">
            <h1>GOD SIMULATOR 4.1</h1>
            <input type="text" id="god-input" placeholder="Divine Name...">
            <button onclick="checkIdentity()">Genesis</button>
        </div>
    </div>

    <div id="resource-bar">
        <span>Iso: <b id="isotope-count">0</b></span>
        <span>Faith: <b id="faith-count" class="faith-text">0</b></span>
    </div>

    <nav id="main-nav">
        <button onclick="showScreen('play-screen')">World</button>
        <button onclick="showScreen('skill-screen')">Skills</button>
        <button onclick="showScreen('stats-screen')">Stats</button>
    </nav>

    <main>
        <section id="play-screen" class="screen">
            <h2>Current Planet</h2>
            <div id="grid-9x9"></div>
            <button onclick="advanceDay()">Advance Day</button>
            <div class="p-bar-bg" style="width: 280px;"><div id="progress-bar"></div></div>
        </section>

        <section id="skill-screen" class="screen" style="display:none;"><div id="skills-container"></div></section>
        <section id="stats-screen" class="screen" style="display:none;">
            <div class="upgrade-card">Rebirths: <b id="stat-rebirths">0</b></div>
        </section>
    </main>

    <script>
        var skillsData = [
            { id: 0, name: "Tectonics", level: 0, base: 50, req: -1 },
            { id: 1, name: "Atmosphere", level: 0, base: 250, req: 0 },
            { id: 2, name: "Ozone", level: 0, base: 1000, req: 1 },
            { id: 3, name: "Hydration", level: 0, base: 4000, req: 2 },
            { id: 4, name: "Biosphere", level: 0, base: 15000, req: 3 },
            { id: 5, name: "Flora", level: 0, base: 60000, req: 4 },
            { id: 6, name: "Civilization", level: 0, base: 250000, req: 5 },
            { id: 7, name: "MegaCities", level: 0, base: 1000000, req: 6 }
        ];

        var isotopes = 0, faith = 0, currentDay = 1;

        function checkIdentity() {
            document.getElementById('login-screen').style.display = 'none';
            createGrid(); 
            updateWorldVisuals();
            updateUI();
        }

        function createGrid() {
            const grid = document.getElementById('grid-9x9');
            grid.innerHTML = "";
            for (let i = 0; i < 81; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                grid.appendChild(tile);
            }
        }

        function updateWorldVisuals() {
            const tiles = document.querySelectorAll('.tile');
            if (tiles.length === 0) return;

            tiles.forEach((t, i) => {
                t.className = 'tile'; // Reset
                if (i < skillsData[7].level * 10) t.classList.add('stage-city');
                else if (i < skillsData[5].level * 12) t.classList.add('stage-flowers');
                else if (i < skillsData[3].level * 15) t.classList.add('stage-ocean');
                else if (i < skillsData[1].level * 15) t.classList.add('stage-red');
                else if (i < skillsData[0].level * 20) t.classList.add('stage-rock');
            });

            let totalLv = skillsData.reduce((a, b) => a + b.level, 0);
            document.getElementById('progress-bar').style.width = (totalLv / 40 * 100) + "%";
        }

        function advanceDay() {
            if (currentDay < 20) {
                currentDay++;
            } else {
                currentDay = 1;
                isotopes += 50 + (skillsData.reduce((a,b)=>a+b.level,0) * 25);
            }
            updateUI();
        }

        function buySkill(id) {
            let s = skillsData[id];
            let cost = Math.floor(s.base * Math.pow(2.2, s.level));
            if (isotopes >= cost) {
                isotopes -= cost;
                s.level++;
                updateWorldVisuals();
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('isotope-count').innerText = Math.floor(isotopes).toLocaleString();
            const sCon = document.getElementById('skills-container');
            sCon.innerHTML = "<h2>Restore the Planet</h2>";
            skillsData.forEach(s => {
                let canBuy = s.req === -1 || skillsData[s.req].level > 0;
                let cost = Math.floor(s.base * Math.pow(2.2, s.level));
                sCon.innerHTML += `
                    <div class="upgrade-card" style="opacity:${canBuy?1:0.3}">
                        <b>${canBuy ? s.name : "???"}</b> (Lv ${s.level}/5)<br>
                        <button onclick="buySkill(${s.id})" ${isotopes < cost || !canBuy || s.level >= 5 ? 'disabled' : ''}>
                            ${s.level >= 5 ? 'MAX' : cost.toLocaleString() + ' Iso'}
                        </button>
                    </div>`;
            });
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }
    </script>
</body>
</html>
